<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLEUPrint: Digital Financial Literacy Board Game v2.1</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQkxFVVByaW50Iiwic2hvcnRfbmFtZSI6IkJMRVVQcmludCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSJ9">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e27;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        /* Animated Background */
        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, #1a1f3a, #0a0e27, #2d1b69, #0f3460);
            animation: gradientShift 15s ease infinite;
            opacity: 0.8;
        }
        @keyframes gradientShift {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-30%, -30%) rotate(180deg); }
        }
        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        /* Top Bar - Electronic Display Style */
        .top-bar {
            background: linear-gradient(180deg, #1a1f3a 0%, #0f1528 100%);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #00ffcc;
            box-shadow: 0 4px 20px rgba(0, 255, 204, 0.3);
        }
        .game-title {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(90deg, #00ffcc, #00aaff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 255, 204, 0.5);
            animation: glow 2s ease-in-out infinite;
            cursor: pointer;
        }
        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        .top-stats {
            display: flex;
            gap: 30px;
        }
        .stat-display {
            background: rgba(0, 255, 204, 0.1);
            border: 2px solid #00ffcc;
            border-radius: 10px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #00ffcc;
            font-weight: bold;
            box-shadow: inset 0 0 20px rgba(0, 255, 204, 0.2);
        }
        .stat-display .label {
            color: #8892b0;
            font-size: 0.9em;
        }
        .stat-display .value {
            font-size: 1.3em;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.8);
        }
        /* Sound Controls */
        .sound-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .sound-btn {
            background: rgba(0, 255, 204, 0.2);
            border: 2px solid #00ffcc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #00ffcc;
            font-size: 1.2em;
        }
        .sound-btn:hover {
            background: rgba(0, 255, 204, 0.4);
            transform: scale(1.1);
        }
        .sound-btn.muted {
            color: #666;
            border-color: #666;
            background: rgba(102, 102, 102, 0.2);
        }
        /* Main Game Area */
        .game-area {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        /* Left Panel - Players */
        .left-panel {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .player-container {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #2a3f5f;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            flex: 1;
            overflow-y: auto;
        }
        .player-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 204, 0.3), transparent);
            transition: left 0.5s ease;
        }
        .player-card.active {
            border-color: #00ffcc;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.5);
        }
        .player-card.active::before {
            left: 100%;
        }
        .player-card.ai {
            background: rgba(139, 92, 246, 0.1);
        }
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .player-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .ai-badge {
            background: #8b5cf6;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .player-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .player-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .player-stat-label {
            color: #8892b0;
            font-size: 0.85em;
        }
        .player-stat-value {
            color: #00ffcc;
            font-weight: bold;
            font-size: 0.95em;
        }
        /* Game Controls */
        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .control-btn {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border: 2px solid #2a3f5f;
            color: #00ffcc;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-align: center;
        }
        .control-btn:hover {
            border-color: #00ffcc;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.3);
        }
        /* Center - Game Board (Monopoly Style) */
        .board-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .game-board {
            width: min(80vh, 100%);
            height: min(80vh, 100%);
            position: relative;
            background: linear-gradient(145deg, #0f1528, #1a1f3a);
            border-radius: 20px;
            box-shadow:
                0 0 100px rgba(0, 255, 204, 0.2),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            gap: 2px;
            padding: 10px;
        }
        /* Board Spaces */
        .board-space {
            background: linear-gradient(145deg, #1e2139, #161825);
            border: 1px solid #2a3f5f;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 5px;
        }
        .board-space:hover {
            transform: translateZ(10px) scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 204, 0.4);
            border-color: #00ffcc;
            z-index: 10;
        }
        /* Corner Spaces (Larger) */
        .corner-space {
            grid-column: span 2;
            grid-row: span 2;
            font-size: 1.2em;
            font-weight: bold;
        }
        /* Special Space Types */
        .space-start {
            background: linear-gradient(145deg, #00ff88, #00cc66);
            color: #000;
            font-weight: bold;
        }
        .space-grant {
            background: linear-gradient(145deg, #4a9eff, #2d7dd2);
        }
        .space-obstacle {
            background: linear-gradient(145deg, #ff6b6b, #ee5a6f);
        }
        .space-powerup {
            background: linear-gradient(145deg, #ffd93d, #ffb700);
            color: #000;
        }
        .space-investment {
            background: linear-gradient(145deg, #a78bfa, #8b5cf6);
        }
        .space-community {
            background: linear-gradient(145deg, #34d399, #10b981);
        }
        .space-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        .space-label {
            font-size: 0.7em;
            color: #fff;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        /* Center Display Area */
        .board-center {
            grid-column: 3 / 10;
            grid-row: 3 / 10;
            background: linear-gradient(145deg, #0a0e27, #151929);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border: 3px solid #00ffcc;
            box-shadow: inset 0 0 50px rgba(0, 255, 204, 0.1);
        }
        .center-logo {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(90deg, #00ffcc, #00aaff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .dice-container {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            min-height: 60px;
        }
        .die {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #fff, #f0f0f0);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: #0a0e27;
            box-shadow:
                0 5px 15px rgba(0, 0, 0, 0.3),
                inset 0 -2px 5px rgba(0, 0, 0, 0.1);
            animation: none;
        }
        .die.rolling {
            animation: diceRoll 0.5s ease-in-out;
        }
        @keyframes diceRoll {
            0% { transform: rotateX(0) rotateY(0); }
            50% { transform: rotateX(720deg) rotateY(720deg); }
            100% { transform: rotateX(0) rotateY(0); }
        }
        .action-button {
            background: linear-gradient(145deg, #00ffcc, #00cc99);
            color: #0a0e27;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 255, 204, 0.3);
            margin: 5px;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 204, 0.5);
        }
        .action-button:active {
            transform: translateY(0);
        }
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .action-button.secondary {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: white;
        }
        /* Right Panel - Cards & Info */
        .right-panel {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .card-display {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #2a3f5f;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-height: 250px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        .card-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 255, 204, 0.1) 0%, transparent 70%);
            animation: cardGlow 3s ease-in-out infinite;
        }
        @keyframes cardGlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        .card-header {
            font-size: 1.3em;
            font-weight: bold;
            color: #00ffcc;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a3f5f;
            position: relative;
            z-index: 1;
        }
        .card-content {
            color: #8892b0;
            line-height: 1.6;
            position: relative;
            z-index: 1;
            flex: 1;
        }
        .card-stat {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        .card-stat-label {
            color: #8892b0;
        }
        .card-stat-value {
            color: #00ffcc;
            font-weight: bold;
        }
        /* Stats Dashboard - New */
        .stats-dashboard {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #2a3f5f;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        /* Achievements Panel */
        .achievements-panel {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #2a3f5f;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .achievement-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .achievement-badge {
            background: rgba(0, 255, 204, 0.1);
            border: 1px solid #00ffcc;
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 0.85em;
            color: #00ffcc;
            display: flex;
            align-items: center;
            gap: 5px;
            opacity: 0.3;
            transition: all 0.3s ease;
        }
        .achievement-badge.unlocked {
            opacity: 1;
            background: linear-gradient(145deg, rgba(0, 255, 204, 0.2), rgba(0, 255, 204, 0.1));
            animation: achievementUnlock 0.5s ease;
        }
        @keyframes achievementUnlock {
            0% { transform: scale(1.5) rotate(10deg); }
            50% { transform: scale(1.2) rotate(-5deg); }
            100% { transform: scale(1) rotate(0); }
        }
        /* Game Log */
        .game-log {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #2a3f5f;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid #00ffcc;
            border-radius: 5px;
            color: #8892b0;
            font-size: 0.9em;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        /* Player Tokens */
        .player-token {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow:
                0 0 10px rgba(0, 0, 0, 0.5),
                0 0 20px currentColor;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 3px solid #00ffcc;
            box-shadow: 0 0 50px rgba(0, 255, 204, 0.3);
            animation: modalEntry 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }
        @keyframes modalEntry {
            from {
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        .modal-header {
            font-size: 1.8em;
            font-weight: bold;
            color: #00ffcc;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
        }
        .modal-body {
            color: #8892b0;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(145deg, #1a1f3a, #151929);
            border: 2px solid #00ffcc;
            border-radius: 10px;
            padding: 15px 20px;
            color: #00ffcc;
            font-weight: bold;
            z-index: 2000;
            animation: toastSlide 0.3s ease;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.5);
            display: none;
        }
        @keyframes toastSlide {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0e27;
        }
        ::-webkit-scrollbar-thumb {
            background: #00ffcc;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00cc99;
        }
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
            }
            .left-panel, .right-panel {
                width: 100%;
            }
            .game-board {
                width: 100vw;
                height: 60vh;
                padding: 5px;
            }
            .action-button {
                padding: 16px 40px;
                font-size: 1.3em;
            }
            .top-bar {
                padding: 10px 15px;
                flex-wrap: wrap;
            }
            .top-stats {
                gap: 10px;
                font-size: 0.9em;
            }
            .die {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
        }
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .space-label { text-shadow: none; border: 1px solid #fff; }
            .player-stat { background: #fff; color: #000; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="game-title" onclick="showAbout()">BLEUPrint v2.1</div>
            <div class="top-stats">
                <div class="stat-display">
                    <span class="label">Round</span>
                    <span class="value" id="roundNumber">1</span>
                </div>
                <div class="stat-display">
                    <span class="label">Turn</span>
                    <span class="value" id="currentTurn">Player 1</span>
                </div>
                <div class="stat-display">
                    <span class="label">Target</span>
                    <span class="value">100 WP</span>
                </div>
            </div>
            <div class="sound-controls">
                <button class="sound-btn" id="soundBtn" onclick="toggleSound()" title="Toggle Sound" aria-label="Toggle sound">üîä</button>
                <button class="sound-btn" onclick="showSettings()" title="Settings" aria-label="Settings">‚öôÔ∏è</button>
                <button class="sound-btn" onclick="showHelp()" title="Help" aria-label="Help">‚ùì</button>
            </div>
        </div>
        <!-- Main Game Area -->
        <div class="game-area">
            <!-- Left Panel - Players -->
            <div class="left-panel">
                <div class="player-container">
                    <h3 style="color: #00ffcc; margin-bottom: 15px; text-align: center;">PLAYERS</h3>
                    <div id="playersList"></div>
                </div>
                <div class="game-controls">
                    <button class="control-btn" onclick="startNewGame()">üéÆ NEW GAME</button>
                    <button class="control-btn" onclick="saveGame()">üíæ SAVE GAME</button>
                    <button class="control-btn" onclick="loadGame()">üìÇ LOAD GAME</button>
                    <button class="control-btn" onclick="toggleAI()">ü§ñ ADD AI</button>
                </div>
            </div>
            <!-- Center - Game Board -->
            <div class="board-container">
                <div class="game-board" id="gameBoard">
                    <!-- Board will be generated here -->
                </div>
            </div>
            <!-- Right Panel -->
            <div class="right-panel">
                <div class="card-display">
                    <div class="card-header">Mission Control</div>
                    <div class="card-content" id="cardContent">
                        <p>Roll the dice to begin your journey to financial sovereignty!</p>
                    </div>
                    <div id="cardActions" style="margin-top: auto; padding-top: 15px;"></div>
                </div>
                <!-- New Stats Dashboard -->
                <div class="stats-dashboard">
                    <h4 style="color: #00ffcc; margin-bottom: 10px;">üìä Literacy Stats</h4>
                    <div class="stats-grid" id="statsGrid">
                        <div class="card-stat"><span class="card-stat-label">Success Rate</span><span class="card-stat-value" id="successRate">0%</span></div>
                        <div class="card-stat"><span class="card-stat-label">Risk Score</span><span class="card-stat-value" id="riskScore">Low</span></div>
                        <div class="card-stat"><span class="card-stat-label">Grants Done</span><span class="card-stat-value" id="grantsDone">0</span></div>
                        <div class="card-stat"><span class="card-stat-label">Barriers Beat</span><span class="card-stat-value" id="barriersBeat">0</span></div>
                    </div>
                </div>
                <div class="achievements-panel">
                    <h4 style="color: #00ffcc; margin-bottom: 10px;">üèÜ Achievements</h4>
                    <div class="achievement-list" id="achievementList"></div>
                </div>
                <div class="game-log">
                    <h4 style="color: #00ffcc; margin-bottom: 10px;">üìã Activity Log</h4>
                    <div id="gameLog"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">Welcome</div>
            <div class="modal-body" id="modalBody">Loading...</div>
            <div class="modal-buttons">
                <button class="action-button" onclick="closeModal()">CONTINUE</button>
            </div>
        </div>
    </div>
    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast"></div>
    <script>
        // Complete Game Implementation with All Features - Updated v2.1 (Dec 2025)
       
        // Audio System
        let audioContext = null;
        let soundEnabled = true;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        const sounds = {
            diceRoll: { frequency: 800, duration: 100, type: 'square' },
            success: { frequency: 1200, duration: 200, type: 'sine' },
            failure: { frequency: 400, duration: 300, type: 'sawtooth' },
            powerUp: { frequency: 1600, duration: 150, type: 'triangle' },
            achievement: { frequency: [800, 1200, 1600], duration: 500, type: 'sine' },
            move: { frequency: 600, duration: 50, type: 'sine' },
            click: { frequency: 1000, duration: 30, type: 'square' }
        };
        function playSound(soundName) {
            if (!soundEnabled || !sounds[soundName]) return;
            try {
                initAudio();
                const sound = sounds[soundName];
                if (Array.isArray(sound.frequency)) {
                    sound.frequency.forEach((freq, index) => {
                        setTimeout(() => {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.frequency.value = freq;
                            osc.type = sound.type;
                            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                            osc.start(audioContext.currentTime);
                            osc.stop(audioContext.currentTime + 0.1);
                        }, index * 100);
                    });
                } else {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.value = sound.frequency;
                    oscillator.type = sound.type;
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + sound.duration / 1000);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + sound.duration / 1000);
                }
            } catch (e) {
                console.log('Audio error:', e);
            }
        }
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundBtn = document.getElementById('soundBtn');
            soundBtn.textContent = soundEnabled ? 'üîä' : 'üîá';
            soundBtn.classList.toggle('muted', !soundEnabled);
            playSound('click');
        }
        // Achievement System
        const achievements = {
            firstGrant: { id: 'firstGrant', name: 'First Steps', icon: 'üéØ', description: 'Complete your first grant', unlocked: false },
            wealthBuilder: { id: 'wealthBuilder', name: 'Wealth Builder', icon: 'üí∞', description: 'Reach 50 WP', unlocked: false },
            sovereign: { id: 'sovereign', name: 'Sovereign', icon: 'üëë', description: 'Win a game', unlocked: false },
            speedRunner: { id: 'speedRunner', name: 'Speed Runner', icon: '‚ö°', description: 'Win in under 10 rounds', unlocked: false },
            survivor: { id: 'survivor', name: 'Survivor', icon: 'üõ°Ô∏è', description: 'Overcome 5 obstacles', unlocked: false },
            networker: { id: 'networker', name: 'Networker', icon: 'ü§ù', description: 'Land on 10 community spaces', unlocked: false },
            powerPlayer: { id: 'powerPlayer', name: 'Power Player', icon: '‚≠ê', description: 'Collect 5 power-ups', unlocked: false },
            investor: { id: 'investor', name: 'Investor', icon: 'üìà', description: 'Earn 50 WP from investments', unlocked: false }
        };
        // Game State
        let gameState = {
            players: [],
            currentPlayer: 0,
            round: 1,
            board: [],
            currentCard: null,
            gameActive: false,
            boardSpaces: 40,
            diceRolled: false,
            aiEnabled: false,
            statistics: {
                grantsCompleted: 0,
                obstaclesOvercome: 0,
                communitySpacesLanded: 0,
                powerUpsCollected: 0,
                investmentEarnings: 0,
                totalGamesPlayed: 0,
                totalAttempts: 0, // New for stats
                successfulAttempts: 0 // New for stats
            }
        };
        // Updated Card Databases (2025 Additions)
        const missionCards = [
            {
                title: "Small Business Grant",
                description: "Apply for a $10,000 small business grant from the SBA",
                requirements: "Business Plan + 2 Resource Tokens",
                successRate: 70,
                wealthReward: 15,
                resourceCost: 2,
                learning: "SBIR/STTR grant processes"
            },
            {
                title: "Education Scholarship",
                description: "Apply for a need-based education scholarship",
                requirements: "Academic Achievement + 1 Resource Token",
                successRate: 60,
                wealthReward: 10,
                resourceCost: 1,
                learning: "FAFSA and scholarship applications"
            },
            {
                title: "Community Development Fund",
                description: "Partner with neighbors for community improvement grant",
                requirements: "2+ Players Collaboration",
                successRate: 85,
                wealthReward: 20,
                resourceCost: 2,
                learning: "Collective impact funding models"
            },
            {
                title: "Tech Innovation Grant",
                description: "Secure funding for your technology startup idea",
                requirements: "Tech Skills + 3 Resource Tokens",
                successRate: 50,
                wealthReward: 25,
                resourceCost: 3,
                learning: "Venture capital and accelerators"
            },
            {
                title: "Arts & Culture Grant",
                description: "Fund your creative project through NEA grants",
                requirements: "Creative Portfolio + 1 Resource Token",
                successRate: 65,
                wealthReward: 12,
                resourceCost: 1,
                learning: "Arts funding ecosystems"
            },
            {
                title: "Green Energy Initiative",
                description: "Solar panel installation grant for your home",
                requirements: "Environmental Plan + 2 Resource Tokens",
                successRate: 75,
                wealthReward: 18,
                resourceCost: 2,
                learning: "Renewable energy incentives"
            },
            {
                title: "Healthcare Innovation Fund",
                description: "Develop community health solutions",
                requirements: "Health Impact Study + 3 Resource Tokens",
                successRate: 55,
                wealthReward: 22,
                resourceCost: 3,
                learning: "NIH and health grant systems"
            },
            {
                title: "Youth Entrepreneurship Program",
                description: "Mentorship and seed funding for young innovators",
                requirements: "Age 18-25 + 1 Resource Token",
                successRate: 80,
                wealthReward: 8,
                resourceCost: 1,
                learning: "Youth-focused funding opportunities"
            },
            // New 2025 Cards
            {
                title: "AI Startup Accelerator",
                description: "Join an AI ethics grant program for innovative tech",
                requirements: "AI Prototype + 2 Resource Tokens",
                successRate: 65,
                wealthReward: 20,
                resourceCost: 2,
                learning: "2025 AI funding ethics and accelerators"
            },
            {
                title: "Gig Economy Relief Fund",
                description: "Secure support for freelance creators in the gig wave",
                requirements: "Portfolio + 1 Resource Token",
                successRate: 70,
                wealthReward: 12,
                resourceCost: 1,
                learning: "Gig worker protections and grants"
            },
            {
                title: "Sustainable Impact Investing",
                description: "Fund ESG-compliant green projects",
                requirements: "Impact Report + 3 Resource Tokens",
                successRate: 60,
                wealthReward: 25,
                resourceCost: 3,
                learning: "ESG investing trends 2025"
            }
        ];
        const obstacleCards = [
            {
                title: "Credit History Barrier",
                description: "Your lack of credit history limits funding options",
                effect: "Lose 5 WP and skip next turn",
                overcome: "Pay 3 Resource Tokens to continue",
                learning: "Building credit history"
            },
            {
                title: "Digital Divide",
                description: "No internet access blocks online opportunities",
                effect: "Cannot attempt digital missions for 2 turns",
                overcome: "Pay 5 Resource Tokens for tech access",
                learning: "Infrastructure inequity"
            },
            {
                title: "Language Barrier",
                description: "Grant applications only available in English",
                effect: "Lose 3 WP",
                overcome: "Pay 2 Resource Tokens for translation",
                learning: "Accessibility in funding"
            },
            {
                title: "Geographic Isolation",
                description: "Rural location limits access to resources",
                effect: "Move back 3 spaces",
                overcome: "Pay 4 Resource Tokens for transportation",
                learning: "Rural funding challenges"
            },
            {
                title: "Documentation Requirements",
                description: "Complex paperwork delays your progress",
                effect: "Skip next turn",
                overcome: "Pay 2 Resource Tokens for assistance",
                learning: "Navigating bureaucracy"
            },
            // New 2025 Obstacles
            {
                title: "Inflation Surge",
                description: "Rising costs erode your savings buffer",
                effect: "Lose 4 WP from inflation",
                overcome: "Pay 2 Resource Tokens for hedging advice",
                learning: "Inflation-proofing finances in 2025"
            },
            {
                title: "Crypto Scam Alert",
                description: "A digital wallet hack threatens your assets",
                effect: "Lose 3 WP and 1 Resource Token",
                overcome: "Pay 3 Resource Tokens for security upgrade",
                learning: "Cybersecurity in fintech"
            }
        ];
        const powerUpCards = [
            {
                title: "Mentor Network",
                description: "Experienced advisors guide your applications",
                effect: "+15% success rate for 3 turns",
                duration: 3
            },
            {
                title: "Technology Upgrade",
                description: "Access to computer and high-speed internet",
                effect: "Overcome digital barriers instantly",
                duration: -1
            },
            {
                title: "Community Alliance",
                description: "Strong community support backs your efforts",
                effect: "Double rewards on next mission",
                duration: 1
            },
            {
                title: "Grant Writer Pro",
                description: "Professional assistance with applications",
                effect: "+25% success rate on next mission",
                duration: 1
            },
            {
                title: "Financial Advisor",
                description: "Expert wealth management guidance",
                effect: "+3 WP passive income per turn",
                duration: 5
            },
            // New 2025 Power-Up
            {
                title: "Risk Analyzer Tool",
                description: "AI-powered risk assessment for investments",
                effect: "+10 WP on next investment + risk education",
                duration: 2
            }
        ];
        // Board Layout - Monopoly Style
        const boardLayout = [
            // Top row (0-10)
            { type: 'start', label: 'START', icon: 'üèÅ', corner: true },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'community', label: 'COMMUNITY', icon: 'ü§ù' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' },
            { type: 'investment', label: 'INVEST', icon: 'üíπ' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'powerup', label: 'POWER', icon: '‚ö°' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'community', label: 'COMMUNITY', icon: 'ü§ù' },
            { type: 'investment', label: 'FREE INVEST', icon: 'üí∞', corner: true },
            // Right column (11-19)
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'powerup', label: 'POWER', icon: '‚ö°' },
            { type: 'investment', label: 'INVEST', icon: 'üíπ' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'community', label: 'COMMUNITY', icon: 'ü§ù' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' },
            // Bottom row (20-30) - reversed
            { type: 'obstacle', label: 'MAJOR BARRIER', icon: 'üö´', corner: true },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'powerup', label: 'POWER', icon: '‚ö°' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'investment', label: 'INVEST', icon: 'üíπ' },
            { type: 'community', label: 'COMMUNITY', icon: 'ü§ù' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'powerup', label: 'POWER', icon: '‚ö°' },
            { type: 'powerup', label: 'MEGA POWER', icon: 'üåü', corner: true },
            // Left column (31-39) - going up
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'community', label: 'COMMUNITY', icon: 'ü§ù' },
            { type: 'investment', label: 'INVEST', icon: 'üíπ' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'powerup', label: 'POWER', icon: '‚ö°' },
            { type: 'grant', label: 'GRANT', icon: 'üìã' },
            { type: 'obstacle', label: 'BARRIER', icon: '‚ö†Ô∏è' }
        ];
        // Updated AI Player Logic with Risk Tolerance
        class AIPlayer {
            constructor(difficulty = 'normal') {
                this.difficulty = difficulty;
                this.strategies = {
                    easy: { riskTolerance: 0.3, resourceManagement: 0.5 },
                    normal: { riskTolerance: 0.5, resourceManagement: 0.7 },
                    hard: { riskTolerance: 0.7, resourceManagement: 0.9 }
                };
            }
            makeDecision(player, card) {
                const strategy = this.strategies[this.difficulty];
                if (card && card.type === 'mission') {
                    const successChance = card.successRate / 100;
                    const resourceRatio = player.resources / card.resourceCost;
                    const wealthRatio = player.wealth / 100;
                    // Updated: Factor in risk for 2025 fintech sim
                    const riskAdjusted = successChance * (1 + strategy.riskTolerance);
                    const shouldAttempt = riskAdjusted > 0.6 && resourceRatio > 1.2 && wealthRatio < 0.7;
                    return shouldAttempt ? 'attempt' : 'skip';
                }
                if (card && card.type === 'obstacle') {
                    const canAfford = player.resources >= 3;
                    const shouldOvercome = canAfford && strategy.resourceManagement > 0.6;
                    return shouldOvercome ? 'overcome' : 'accept';
                }
                return 'continue';
            }
            async takeTurn() {
                await new Promise(resolve => setTimeout(resolve, 1000));
                rollDice();
                await new Promise(resolve => setTimeout(resolve, 1500));
                if (gameState.currentCard) {
                    const decision = this.makeDecision(gameState.players[gameState.currentPlayer], gameState.currentCard);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    switch(decision) {
                        case 'attempt': attemptMission(); break;
                        case 'overcome': overcomeObstacle(); break;
                        case 'accept': acceptObstacle(); break;
                        case 'skip': skipMission(); break;
                    }
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
                endTurn();
            }
        }
        const aiPlayer = new AIPlayer('normal');
        // Initialize Game
        function initializeGame() {
            createBoard();
            createPlayers();
            initializeAchievements();
            updateStatsDashboard();
            gameState.gameActive = true;
            gameState.diceRolled = false;
            updateDisplay();
            addLogEntry("üéÆ Game initialized! Roll the dice to begin!");
            showNotification("Game Started! v2.1 Loaded", 2000);
        }
        function createBoard() {
            const boardElement = document.getElementById('gameBoard');
            boardElement.innerHTML = '';
            gameState.board = [];
            boardLayout.forEach((space, index) => {
                const spaceElement = document.createElement('div');
                spaceElement.className = `board-space space-${space.type}`;
                spaceElement.id = `space-${index}`;
                spaceElement.setAttribute('aria-label', `${space.label} space`);
                // Position spaces correctly
                if (index <= 10) {
                    spaceElement.style.gridColumn = `${index + 1}`;
                    spaceElement.style.gridRow = '1';
                    if (space.corner) {
                        spaceElement.classList.add('corner-space');
                        spaceElement.style.gridColumn = `span 2`;
                        spaceElement.style.gridRow = `span 2`;
                    }
                } else if (index <= 19) {
                    spaceElement.style.gridColumn = '11';
                    spaceElement.style.gridRow = `${index - 9}`;
                } else if (index <= 30) {
                    spaceElement.style.gridColumn = `${31 - index}`;
                    spaceElement.style.gridRow = '11';
                    if (space.corner) {
                        spaceElement.classList.add('corner-space');
                        spaceElement.style.gridColumn = `span 2`;
                        spaceElement.style.gridRow = `span 2`;
                    }
                } else {
                    spaceElement.style.gridColumn = '1';
                    spaceElement.style.gridRow = `${41 - index}`;
                }
                spaceElement.innerHTML = `
                    <div class="space-icon">${space.icon}</div>
                    <div class="space-label">${space.label}</div>
                `;
                spaceElement.onclick = () => showSpaceInfo(index, space);
                boardElement.appendChild(spaceElement);
                gameState.board.push(space);
            });
            // Add center area
            const centerElement = document.createElement('div');
            centerElement.className = 'board-center';
            centerElement.innerHTML = `
                <div class="center-logo">BLEU</div>
                <div class="dice-container" id="diceContainer"></div>
                <div style="display: flex; gap: 10px;">
                    <button class="action-button" onclick="rollDice()" id="rollBtn" aria-label="Roll dice">ROLL DICE</button>
                    <button class="action-button secondary" onclick="endTurn()" id="endTurnBtn" aria-label="End turn">END TURN</button>
                </div>
            `;
            boardElement.appendChild(centerElement);
            // Touch support for mobile
            let touchStartX = 0;
            document.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
            document.addEventListener('touchend', e => {
                const touchEndX = e.changedTouches[0].clientX;
                if (touchStartX - touchEndX > 50) rollDice(); // Swipe left to roll
            });
        }
        function createPlayers() {
            const playerData = [
                { name: "Player 1", color: "#00ffcc", avatar: "üë§", wealth: 10, resources: 3, position: 0, skipTurns: 0, powerUps: [], isAI: false },
                { name: "AI Player", color: "#ff00ff", avatar: "ü§ñ", wealth: 10, resources: 3, position: 0, skipTurns: 0, powerUps: [], isAI: true }
            ];
            gameState.players = gameState.aiEnabled ? playerData : [playerData[0]];
            updatePlayerDisplay();
            placePlayerTokens();
        }
        function initializeAchievements() {
            const achievementList = document.getElementById('achievementList');
            achievementList.innerHTML = '';
            Object.values(achievements).forEach(achievement => {
                const badge = document.createElement('div');
                badge.className = `achievement-badge ${achievement.unlocked ? 'unlocked' : ''}`;
                badge.title = achievement.description;
                badge.setAttribute('aria-label', achievement.name);
                badge.innerHTML = `${achievement.icon}`;
                achievementList.appendChild(badge);
            });
        }
        function unlockAchievement(achievementId) {
            if (achievements[achievementId] && !achievements[achievementId].unlocked) {
                achievements[achievementId].unlocked = true;
                initializeAchievements();
                showNotification(`üèÜ Achievement: ${achievements[achievementId].name}!`, 3000);
                playSound('achievement');
            }
        }
        function updatePlayerDisplay() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            gameState.players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${index === gameState.currentPlayer ? 'active' : ''} ${player.isAI ? 'ai' : ''}`;
                playerCard.setAttribute('aria-label', `Player ${player.name} stats`);
                playerCard.innerHTML = `
                    <div class="player-header">
                        <div class="player-name">
                            ${player.name}
                            ${player.isAI ? '<span class="ai-badge">AI</span>' : ''}
                        </div>
                        <div class="player-avatar" style="background: ${player.color}">${player.isAI ? 'ü§ñ' : index + 1}</div>
                    </div>
                    <div class="player-stats">
                        <div class="player-stat">
                            <span class="player-stat-label">Wealth Points</span>
                            <span class="player-stat-value">${player.wealth} WP</span>
                        </div>
                        <div class="player-stat">
                            <span class="player-stat-label">Resources</span>
                            <span class="player-stat-value">${player.resources}</span>
                        </div>
                        <div class="player-stat">
                            <span class="player-stat-label">Position</span>
                            <span class="player-stat-value">#${player.position}</span>
                        </div>
                    </div>
                `;
                playersList.appendChild(playerCard);
            });
        }
        function placePlayerTokens() {
            document.querySelectorAll('.player-token').forEach(token => token.remove());
            const positionGroups = {};
            gameState.players.forEach((player, index) => {
                if (!positionGroups[player.position]) positionGroups[player.position] = [];
                positionGroups[player.position].push({ player, index });
            });
            Object.keys(positionGroups).forEach(position => {
                const space = document.getElementById(`space-${position}`);
                if (space) {
                    const playersOnSpace = positionGroups[position];
                    playersOnSpace.forEach((data, offset) => {
                        const token = document.createElement('div');
                        token.className = 'player-token';
                        token.style.background = data.player.color;
                        token.textContent = data.player.isAI ? 'ü§ñ' : data.index + 1;
                        token.style.top = `${5 + offset * 8}px`; // Reduced overlap
                        token.style.left = `${5 + offset * 8}px`;
                        space.appendChild(token);
                    });
                }
            });
        }
        // New Stats Dashboard Update
        function updateStatsDashboard() {
            const totalAttempts = gameState.statistics.totalAttempts || 1;
            const successRate = Math.round((gameState.statistics.successfulAttempts / totalAttempts) * 100);
            document.getElementById('successRate').textContent = `${successRate}%`;
            document.getElementById('riskScore').textContent = gameState.players[gameState.currentPlayer]?.powerUps.some(p => p.title.includes('Risk')) ? 'High' : 'Low';
            document.getElementById('grantsDone').textContent = gameState.statistics.grantsCompleted;
            document.getElementById('barriersBeat').textContent = gameState.statistics.obstaclesOvercome;
        }
        function rollDice() {
            if (!gameState.gameActive) {
                showModal("Game Not Active", "Please start a new game first!");
                return;
            }
            if (gameState.diceRolled) {
                showModal("Already Rolled", "You've already rolled this turn. Take an action or end your turn.");
                return;
            }
            const currentPlayer = gameState.players[gameState.currentPlayer];
            if (currentPlayer.skipTurns > 0) {
                currentPlayer.skipTurns--;
                addLogEntry(`‚è≠Ô∏è ${currentPlayer.name} skips turn (${currentPlayer.skipTurns} remaining)`);
                nextTurn();
                return;
            }
            playSound('diceRoll');
            const diceContainer = document.getElementById('diceContainer');
            diceContainer.innerHTML = '';
            const die1 = Math.floor(Math.random() * 6) + 1;
            const die2 = Math.floor(Math.random() * 6) + 1;
            const total = die1 + die2;
            const dice1Element = document.createElement('div');
            dice1Element.className = 'die rolling';
            const dice2Element = document.createElement('div');
            dice2Element.className = 'die rolling';
            diceContainer.appendChild(dice1Element);
            diceContainer.appendChild(dice2Element);
            setTimeout(() => {
                dice1Element.className = 'die';
                dice1Element.textContent = die1;
                dice2Element.className = 'die';
                dice2Element.textContent = die2;
                const oldPosition = currentPlayer.position;
                currentPlayer.position = (currentPlayer.position + total) % 40;
                if (currentPlayer.position < oldPosition) {
                    currentPlayer.wealth += 10;
                    currentPlayer.resources += 3;
                    addLogEntry(`üèÅ ${currentPlayer.name} passed START! +10 WP, +3 Resources`);
                    playSound('powerUp');
                }
                playSound('move');
                placePlayerTokens();
                const currentSpace = gameState.board[currentPlayer.position];
                addLogEntry(`üé≤ ${currentPlayer.name} rolled ${total} and landed on ${currentSpace.label}`);
                handleSpaceEffect(currentSpace);
                gameState.diceRolled = true;
                updateDisplay();
                updateStatsDashboard();
                checkVictory();
                checkAchievements();
                if (currentPlayer.isAI) {
                    setTimeout(() => {
                        if (gameState.currentCard) {
                            const decision = aiPlayer.makeDecision(currentPlayer, gameState.currentCard);
                            handleAIDecision(decision);
                        } else {
                            endTurn();
                        }
                    }, 2000);
                }
            }, 500);
        }
        function handleAIDecision(decision) {
            switch(decision) {
                case 'attempt': attemptMission(); break;
                case 'overcome': overcomeObstacle(); break;
                case 'accept': acceptObstacle(); break;
                case 'skip': skipMission(); break;
                default: endTurn();
            }
        }
        function handleSpaceEffect(space) {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const cardContent = document.getElementById('cardContent');
            const cardActions = document.getElementById('cardActions');
            switch(space.type) {
                case 'start':
                    cardContent.innerHTML = `
                        <h3>Welcome to START!</h3>
                        <p>You've completed a circuit! Collect your rewards:</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Wealth Bonus</span>
                            <span class="card-stat-value">+10 WP</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Resource Bonus</span>
                            <span class="card-stat-value">+3 Tokens</span>
                        </div>
                    `;
                    cardActions.innerHTML = '';
                    break;
                case 'grant':
                    const missionCard = missionCards[Math.floor(Math.random() * missionCards.length)];
                    gameState.currentCard = { ...missionCard, type: 'mission' };
                    cardContent.innerHTML = `
                        <h3>${missionCard.title}</h3>
                        <p>${missionCard.description}</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Requirements</span>
                            <span class="card-stat-value">${missionCard.resourceCost} Resources</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Success Rate</span>
                            <span class="card-stat-value">${missionCard.successRate}%</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Reward</span>
                            <span class="card-stat-value">+${missionCard.wealthReward} WP</span>
                        </div>
                        <p style="margin-top: 10px; font-style: italic; color: #667eea;">üìö Learn: ${missionCard.learning}</p>
                    `;
                    if (!currentPlayer.isAI) {
                        cardActions.innerHTML = `
                            <button class="action-button" onclick="attemptMission()">ATTEMPT MISSION</button>
                            <button class="action-button secondary" onclick="skipMission()">SKIP</button>
                        `;
                    } else {
                        cardActions.innerHTML = '<p style="color: #8892b0;">AI is thinking...</p>';
                    }
                    break;
                case 'obstacle':
                    const obstacleCard = obstacleCards[Math.floor(Math.random() * obstacleCards.length)];
                    gameState.currentCard = { ...obstacleCard, type: 'obstacle' };
                    cardContent.innerHTML = `
                        <h3 style="color: #ff6b6b;">‚ö†Ô∏è ${obstacleCard.title}</h3>
                        <p>${obstacleCard.description}</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Effect</span>
                            <span class="card-stat-value" style="color: #ff6b6b;">${obstacleCard.effect}</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Overcome</span>
                            <span class="card-stat-value">${obstacleCard.overcome}</span>
                        </div>
                        <p style="margin-top: 10px; font-style: italic; color: #667eea;">üìö Learn: ${obstacleCard.learning}</p>
                    `;
                    if (!currentPlayer.isAI) {
                        cardActions.innerHTML = `
                            <button class="action-button secondary" onclick="overcomeObstacle()">PAY TO OVERCOME</button>
                            <button class="action-button" onclick="acceptObstacle()">ACCEPT PENALTY</button>
                        `;
                    } else {
                        cardActions.innerHTML = '<p style="color: #8892b0;">AI is thinking...</p>';
                    }
                    break;
                case 'powerup':
                    const powerUpCard = powerUpCards[Math.floor(Math.random() * powerUpCards.length)];
                    currentPlayer.powerUps.push(powerUpCard);
                    currentPlayer.resources += 2;
                    gameState.statistics.powerUpsCollected++;
                    cardContent.innerHTML = `
                        <h3 style="color: #ffd93d;">‚ö° ${powerUpCard.title}</h3>
                        <p>${powerUpCard.description}</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Effect</span>
                            <span class="card-stat-value" style="color: #ffd93d;">${powerUpCard.effect}</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Bonus Resources</span>
                            <span class="card-stat-value">+2 Tokens</span>
                        </div>
                    `;
                    cardActions.innerHTML = '';
                    addLogEntry(`‚ö° ${currentPlayer.name} gained power-up: ${powerUpCard.title}`);
                    playSound('powerUp');
                    break;
                case 'investment':
                    const investmentReturn = Math.floor(Math.random() * 15) + 5;
                    currentPlayer.wealth += investmentReturn;
                    gameState.statistics.investmentEarnings += investmentReturn;
                    // New: Risk check for power-up
                    if (currentPlayer.powerUps.some(p => p.title === 'Risk Analyzer Tool')) {
                        investmentReturn += 10;
                        currentPlayer.wealth += 10;
                        addLogEntry(`üîç Risk Analyzer boosted investment by +10 WP!`);
                    }
                    cardContent.innerHTML = `
                        <h3 style="color: #a78bfa;">üíπ Investment Opportunity</h3>
                        <p>Your strategic investment has paid off!</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Investment Return</span>
                            <span class="card-stat-value" style="color: #34d399;">+${investmentReturn} WP</span>
                        </div>
                    `;
                    cardActions.innerHTML = '';
                    addLogEntry(`üí∞ ${currentPlayer.name} earned ${investmentReturn} WP from investments`);
                    playSound('success');
                    break;
                case 'community':
                    currentPlayer.wealth += 5;
                    currentPlayer.resources += 2;
                    gameState.statistics.communitySpacesLanded++;
                    cardContent.innerHTML = `
                        <h3 style="color: #34d399;">ü§ù Community Support</h3>
                        <p>Your community rallies to support your journey!</p>
                        <div class="card-stat">
                            <span class="card-stat-label">Community Aid</span>
                            <span class="card-stat-value">+5 WP</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Shared Resources</span>
                            <span class="card-stat-value">+2 Tokens</span>
                        </div>
                    `;
                    cardActions.innerHTML = '';
                    addLogEntry(`ü§ù ${currentPlayer.name} received community support`);
                    break;
            }
            updatePlayerDisplay();
        }
        function attemptMission() {
            if (!gameState.currentCard || gameState.currentCard.type !== 'mission') {
                showModal("No Mission", "No mission available to attempt!");
                return;
            }
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const card = gameState.currentCard;
            if (currentPlayer.resources < card.resourceCost) {
                showModal("Insufficient Resources", `You need ${card.resourceCost} resources to attempt this mission!`);
                return;
            }
            currentPlayer.resources -= card.resourceCost;
            gameState.statistics.totalAttempts++;
            // Calculate success with power-ups
            let successRate = card.successRate;
            currentPlayer.powerUps.forEach(powerUp => {
                if (powerUp.effect.includes('success rate')) {
                    successRate += 15;
                }
            });
            const roll = Math.random() * 100;
            if (roll < successRate) {
                let reward = card.wealthReward;
                if (currentPlayer.powerUps.some(p => p.effect.includes('Double rewards'))) {
                    reward *= 2;
                }
                currentPlayer.wealth += reward;
                gameState.statistics.successfulAttempts++;
                gameState.statistics.grantsCompleted++;
                addLogEntry(`‚úÖ ${currentPlayer.name} succeeded! +${reward} WP`);
                showModal("Mission Success!", `Congratulations! You earned ${reward} Wealth Points!`);
                playSound('success');
                if (gameState.statistics.grantsCompleted === 1) {
                    unlockAchievement('firstGrant');
                }
            } else {
                addLogEntry(`‚ùå ${currentPlayer.name}'s mission failed`);
                showModal("Mission Failed", "Your application wasn't approved. Keep trying!");
                playSound('failure');
            }
            gameState.currentCard = null;
            updateDisplay();
            updateStatsDashboard();
            checkVictory();
        }
        function skipMission() {
            gameState.currentCard = null;
            document.getElementById('cardContent').innerHTML = '<p>Mission skipped. End your turn when ready.</p>';
            document.getElementById('cardActions').innerHTML = '';
            addLogEntry(`‚è≠Ô∏è ${gameState.players[gameState.currentPlayer].name} skipped the mission`);
        }
        function overcomeObstacle() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const costMatch = gameState.currentCard.overcome.match(/(\d+) Resource/);
            const cost = costMatch ? parseInt(costMatch[1]) : 3;
            if (currentPlayer.resources >= cost) {
                currentPlayer.resources -= cost;
                gameState.statistics.obstaclesOvercome++;
                addLogEntry(`üí™ ${currentPlayer.name} overcame the obstacle (-${cost} resources)`);
                showModal("Obstacle Overcome!", "You successfully navigated the barrier!");
                gameState.currentCard = null;
                document.getElementById('cardContent').innerHTML = '<p>Obstacle overcome! Continue your journey.</p>';
                document.getElementById('cardActions').innerHTML = '';
                playSound('success');
                if (gameState.statistics.obstaclesOvercome === 5) {
                    unlockAchievement('survivor');
                }
            } else {
                showModal("Insufficient Resources", `You need ${cost} resources to overcome this obstacle!`);
            }
            updateDisplay();
            updateStatsDashboard();
        }
        function acceptObstacle() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const card = gameState.currentCard;
            if (card.effect.includes('Lose 5 WP')) {
                currentPlayer.wealth = Math.max(0, currentPlayer.wealth - 5);
                currentPlayer.skipTurns = 1;
            } else if (card.effect.includes('Lose 3 WP')) {
                currentPlayer.wealth = Math.max(0, currentPlayer.wealth - 3);
            } else if (card.effect.includes('Move back')) {
                currentPlayer.position = Math.max(0, currentPlayer.position - 3);
                placePlayerTokens();
            } else if (card.effect.includes('Skip next turn')) {
                currentPlayer.skipTurns = 1;
            }
            addLogEntry(`üòî ${currentPlayer.name} accepted the penalty`);
            gameState.currentCard = null;
            document.getElementById('cardContent').innerHTML = '<p>Penalty accepted. Learn and move forward!</p>';
            document.getElementById('cardActions').innerHTML = '';
            playSound('failure');
            updateDisplay();
            updateStatsDashboard();
        }
        function endTurn() {
            if (!gameState.diceRolled && gameState.gameActive) {
                showModal("Roll First", "You must roll the dice before ending your turn!");
                return;
            }
            nextTurn();
        }
        function nextTurn() {
            gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
            gameState.diceRolled = false;
            if (gameState.currentPlayer === 0) {
                gameState.round++;
                addLogEntry(`üìÖ Round ${gameState.round} begins!`);
                if (gameState.round % 3 === 0) {
                    gameState.players.forEach(player => {
                        const income = Math.floor(player.wealth * 0.1);
                        player.wealth += income;
                        addLogEntry(`üíµ ${player.name} earned ${income} WP passive income`);
                    });
                }
            }
            // Clear card display
            document.getElementById('cardContent').innerHTML = '<p>Roll the dice to continue your journey!</p>';
            document.getElementById('cardActions').innerHTML = '';
            document.getElementById('diceContainer').innerHTML = '';
            updateDisplay();
            updateStatsDashboard();
            const currentPlayer = gameState.players[gameState.currentPlayer];
            if (currentPlayer && currentPlayer.isAI && gameState.gameActive) {
                setTimeout(() => {
                    if (gameState.gameActive) {
                        rollDice();
                    }
                }, 1500);
            }
        }
        function updateDisplay() {
            document.getElementById('roundNumber').textContent = gameState.round;
            document.getElementById('currentTurn').textContent = gameState.players[gameState.currentPlayer]?.name || 'Player 1';
            updatePlayerDisplay();
        }
        function checkVictory() {
            const winner = gameState.players.find(p => p.wealth >= 100);
            if (winner) {
                gameState.gameActive = false;
                showModal("üéâ
